services:
  spacenotes:
    build: .
    container_name: spacenotes
    ports:
      - "5050:3000"  # SpacetimeDB
      - "5052:5052"  # MCP Server
    volumes:
      - /path/to/your/notes:/vault  # Edit this to your notes folder
      - spacetimedb-data:/var/lib/spacetimedb
    restart: unless-stopped

  client:
    image: nginx:alpine
    container_name: spacenotes-client
    ports:
      - "5051:80"
    volumes:
      - ./client-web:/usr/share/nginx/html
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    environment:
      - SPACETIME_HOST=${SPACETIME_HOST:-}
      - SPACETIME_PORT=${SPACETIME_PORT:-5050}
    command: >
      sh -c "echo '{\"spacetimedb_port\": $${SPACETIME_PORT:-5050}}' > /usr/share/nginx/html/config.json && nginx -g 'daemon off;'"
    restart: unless-stopped
    depends_on:
      - spacenotes

  opencode:
    image: ghcr.io/sst/opencode:latest
    container_name: opencode
    ports:
      - "5053:5053"
    volumes:
      - opencode-data:/root/.opencode
      - ./opencode.json:/root/.opencode/config.json:ro
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
    command: ["serve", "--port", "5053", "--hostname", "0.0.0.0"]
    restart: unless-stopped
    depends_on:
      - spacenotes

volumes:
  spacetimedb-data:
  opencode-data:
